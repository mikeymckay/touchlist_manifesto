<html>
  <head>
    <style>
      body{
        font-family: Helvetica;
        font-size: 40px;
        cursor:crosshair;
        width: 800px;
        height: 600px;
        border:10px solid black;
      }
      span.checked{text-decoration: line-through;}
      span.notChecked{color:white}
      input{
        width:500px;
        font-size:8px;
      }
      div#title{
        background:none repeat scroll 0 0 black;
        color:white;
        text-align:center;
      }
      li{
        margin-left:100px;
      }
      button{
        height: 50px;
        cursor: crosshair;
      }
      div#controls{
      }
    </style>
  </head>
  <body>
  <div id='message'></div>
  <div id='title'></div>
  <ul id='list'></ul>
  <div id='controls'>
    <input id='checklist_source' type='text'/>
    <button>Get Checklist</button>
    <button>Finished</button>
  </div>

  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
  <script type='text/javascript'>
    var default_url = "https://spreadsheets.google.com/pub?key=0Ago31JQPZxZrdHF2bWNjcTJFLXJ6UUM5SldEakdEaXc";
    $('input#checklist_source').val(default_url);
    $("button:contains('Get Checklist')").click( function(){
      loadChecklist($('input').val());
    });
    $("button:contains('Finished')").click( function(){
      var result = $('span.checked').length + " out of " + $('span.checkItem').length + " checked";
      submitDataToGoogleForm("http://spreadsheets.google.com/formResponse?key=tU640m3Zj8OROfgGjfHIXHQ",[$('input#checklist_source').val(),result]);
      $('#message')
        .html("Thanks! " + result)
        .fadeOut(3000)
    });

    function submitDataToGoogleForm(url,data){
      // iframe is only used to stop us from loading a new page on submit
      var iframe = "<iframe name='hidden_iframe' id='hidden_iframe' style='display:none;'></iframe>"
      var form = "<form id='google_form' method='post' action='"+url+"' target='hidden_iframe'>"
      // each element of data will be added to a new column
      $.each(data,function(index,value){
        form += "<input type='hidden' id='"+index+"' name='entry."+index+".single' value='" + value +"'>"
      });
      form += "</form>"
      $('body').append(iframe + form);
      $('#google_form').submit();
    }

    function loadChecklist(url){
      url += "&output=html";
      $.get(url, function(data) {
        var spreadsheet = $(data)[0]['responseText']
        $("div#title").text((spreadsheet.match(/<span class="name">(.*) : Sheet1<\/span>/))[1])
        $("ul#list").html("") // Clear list
        $.each(
          // The data are in p elements so iterate on those
          spreadsheet.match(/<p>(.*)<\/p>/g),
          function(index,value){
            $("ul#list").append("<div class='clickable'><span class='checkMark notChecked'>&#10003;</span><span class='checkItem'>"+ $(value).text() +"</span></div>")
          }
        );
        $("span.checkItem").click(function(event){
          $(event.target).prev().toggleClass("notChecked");
          $(event.target).toggleClass("checked");
        });
      });
    };

/**
 * jQuery.ajax mid - CROSS DOMAIN AJAX 
 * ---
 * @author James Padolsey (http://james.padolsey.com)
 * @version 0.11
 * @updated 12-JAN-10
 * ---
 * Note: Read the README!
 * ---
 * @info http://james.padolsey.com/javascript/cross-domain-requests-with-jquery/
 */

jQuery.ajax = (function(_ajax){
    
    var protocol = location.protocol,
        hostname = location.hostname,
        exRegex = RegExp(protocol + '//' + hostname),
        YQL = 'http' + (/^https/.test(protocol)?'s':'') + '://query.yahooapis.com/v1/public/yql?callback=?',
        query = 'select * from html where url="{URL}" and xpath="*"';
    
    function isExternal(url) {
        return !exRegex.test(url) && /:\/\//.test(url);
    }
    
    return function(o) {
        
        var url = o.url;
        
        if ( /get/i.test(o.type) && !/json/i.test(o.dataType) && isExternal(url) ) {
            
            // Manipulate options so that JSONP-x request is made to YQL
            
            o.url = YQL;
            o.dataType = 'json';
            
            o.data = {
                q: query.replace(
                    '{URL}',
                    url + (o.data ?
                        (/\?/.test(url) ? '&' : '?') + jQuery.param(o.data)
                    : '')
                ),
                format: 'xml'
            };
            
            // Since it's a JSONP request
            // complete === success
            if (!o.success && o.complete) {
                o.success = o.complete;
                delete o.complete;
            }
            
            o.success = (function(_success){
                return function(data) {
                    
                    if (_success) {
                        // Fake XHR callback.
                        _success.call(this, {
                            responseText: data.results[0]
                                // YQL screws with <script>s
                                // Get rid of them
                                .replace(/<script[^>]+?\/>|<script(.|\s)*?\/script>/gi, '')
                        }, 'success');
                    }
                    
                };
            })(o.success);
            
        }
        
        return _ajax.apply(this, arguments);
        
    };
    
})(jQuery.ajax);

  </script>
  </body>
</html>
